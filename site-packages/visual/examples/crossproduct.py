#!/usr/bin/env python
#coding:utf-8
"""
Demonstration of vector cross product

Vector cross product: Red cross Green = Yellow
Drag to change green vector
Click to toggle fixed angle or fixed length
"""
from __future__ import print_function, division

import visual as vp

print(__doc__)

# Ruth Chabay

vp.scene.title = "Vector Cross Product"
vp.scene.width = 600
vp.scene.height = 600
R = 0.15*4
PLANE = vp.curve(
    pos=[(0, -10, -10), (0, -10, 10), (0, 10, 10), (0, 10, -10),
         (0, -10, -10), (0, -6, -10), (0, -6, 10), (0, -2, 10), (0, -2, -10),
         (0, 2, -10), (0, 2, 10), (0, 6, 10), (0, 6, -10), (0, 10, -10),
         (0, 10, -6), (0, -10, -6), (0, -10, -2), (0, 10, -2), (0, 10, 2),
         (0, -10, 2), (0, -10, 6), (0, 10, 6)])

S_THETA = vp.sphere(pos=(0, -12, -10), radius=0.6, color=(0.6, 1.0, 0.6))
S_THETA_LABEL = vp.label(pos=S_THETA.pos, text="Fix Angle", yoffset=-5,
                         opacity=0, box=0, line=0)
S_LENGTH = vp.sphere(pos=(0, -12, 10), radius=0.6, color=(0.6, 0.6, 1.0))
S_LENGTH_LABEL = vp.label(pos=S_LENGTH.pos, text="Fix Length", yoffset=-5,
                          opacity=0, box=0, line=0)

S_TEXT = vp.label(pos=(0, 12, 0), text="Yellow = Red x Green",
                  opacity=0, box=0, line=0)

FIXLENGTH = 0
FIXTHETA = 0

AVECTOR = vp.array([0, 0, -3.5])
BVECTOR = vp.vector(0, 3, 2)

A = vp.arrow(pos=(0, 0, 0), shaftwidth=R, color=vp.color.red)
B = vp.arrow(pos=(0, 0, 0), axis=BVECTOR, shaftwidth=R, color=vp.color.green)
A.axis = AVECTOR
CVECTOR = vp.cross(AVECTOR, BVECTOR)
C = vp.arrow(pos=(0, 0, 0), axis=CVECTOR, shaftwidth=R, color=vp.color.yellow)

vp.scene.autoscale = 0
vp.scene.forward = (-1, -.5, -1)

DRAG = 0

while True:
    vp.rate(100)
    if vp.scene.mouse.events:
        M = vp.scene.mouse.getevent()
        if M.drag:
            DRAG = True
            OBS = None
        elif M.drop:
            DRAG = False
        elif M.click:
            if M.pick is S_LENGTH:
                if FIXTHETA:
                    FIXTHETA = not FIXTHETA
                    S_THETA.color = (0.6, 1.0, 0.6)
                FIXLENGTH = not FIXLENGTH
                if FIXLENGTH:
                    S_LENGTH.color = (0.0, 0.0, 1.0)
                else:
                    S_LENGTH.color = (0.6, 0.6, 1.0)
            elif M.pick is S_THETA:
                if FIXLENGTH:
                    FIXLENGTH = not FIXLENGTH
                    S_LENGTH.color = (0.6, 0.6, 1.0)
                FIXTHETA = not FIXTHETA
                if FIXTHETA:
                    S_THETA.color = (0.0, 1.0, 0.0)
                else:
                    S_THETA.color = (0.6, 1.0, 0.6)
    if DRAG:
        vp.rate(100)
        NEWOBS = vp.scene.mouse.project(normal=vp.vector(1, 0, 0), d=0)
        if NEWOBS and (NEWOBS != OBS):
            OBS = NEWOBS
            if not FIXLENGTH and not FIXTHETA:
                BVECTOR = OBS
                if BVECTOR.mag > 20:
                    BVECTOR = BVECTOR*(20/BVECTOR.mag)
                B.axis = BVECTOR
            elif FIXLENGTH:
                LENGTH = 3.9
                BVECTOR = LENGTH*vp.norm(OBS)
                B.axis = BVECTOR
            elif FIXTHETA:
                LENGTH = vp.mag(OBS)
                BVECTOR = LENGTH*vp.norm(vp.vector(0, 0.3, 1))
                B.axis = BVECTOR

            CVECTOR = vp.cross(AVECTOR, B.axis)
            C.axis = CVECTOR

